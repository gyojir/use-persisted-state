import{useState as n,useEffect as t,useRef as e,useCallback as r}from"react";import u from"@use-it/event-listener";var c={},i=function(n,t,e){return c[n]||(c[n]={callbacks:[],value:e}),c[n].callbacks.push(t),{deregister:function(){var e=c[n].callbacks,r=e.indexOf(t);r>-1&&e.splice(r,1)},emit:function(e){c[n].value!==e&&(c[n].value=e,c[n].callbacks.forEach(function(n){t!==n&&n(e)}))}}};export default function(c,o){if(void 0===o&&(o=global.localStorage),o){var a=function(n){return{get:function(t,e){var r=n.getItem(t);return null===r?"function"==typeof e?e():e:JSON.parse(r)},set:function(t,e){n.setItem(t,JSON.stringify(e))}}}(o);return function(o){return function(c,o,a){var f=a.get,l=a.set,s=e(null),v=n(function(){return f(o,c)}),g=v[0],p=v[1];u("storage",function(n){if(n.key===o){var t=JSON.parse(n.newValue);g!==t&&p(t)}}),t(function(){return s.current=i(o,p,c),function(){s.current.deregister()}},[]);var m=r(function(n){p(function(t){var e="function"==typeof n?n(t):n;return l(o,e),s.current.emit(e),e})},[l,o]);return[g,m]}(o,c,a)}}return n}
